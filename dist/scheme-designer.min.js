var SchemeDesigner;!function(t){var e=function(){function e(e,n){this.renderingRequestId=0,this.devicePixelRatio=1,this.defaultCursorStyle="default",this.fakeSchemeRatio=1.8,this.canvas=e,this.scrollManager=new t.ScrollManager(this),this.zoomManager=new t.ZoomManager(this),this.eventManager=new t.EventManager(this),this.storageManager=new t.StorageManager(this),this.resize(),this.canvas2DContext=this.canvas.getContext("2d"),this.requestFrameAnimation=t.Polyfill.getRequestAnimationFrameFunction(),this.cancelFrameAnimation=t.Polyfill.getCancelAnimationFunction(),this.devicePixelRatio=t.Polyfill.getDevicePixelRatio(),n&&(t.Tools.configure(this,n.options),t.Tools.configure(this.scrollManager,n.scroll),t.Tools.configure(this.zoomManager,n.zoom),t.Tools.configure(this.storageManager,n.storage)),this.disableCanvasSelection(),this.eventManager.bindEvents()}return e.prototype.resize=function(){var e=Math.max(0,Math.floor(t.Tools.getMaximumWidth(this.canvas))),n=Math.max(0,Math.floor(t.Tools.getMaximumHeight(this.canvas)));this.width=this.canvas.width=e,this.height=this.canvas.height=n,this.zoomManager.resetScale()},e.prototype.getEventManager=function(){return this.eventManager},e.prototype.getScrollManager=function(){return this.scrollManager},e.prototype.getZoomManager=function(){return this.zoomManager},e.prototype.getStorageManager=function(){return this.storageManager},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.requestFrameAnimationApply=function(t){return this.requestFrameAnimation.apply(window,[t])},e.prototype.cancelAnimationFrameApply=function(t){return this.cancelFrameAnimation.apply(window,[t])},e.prototype.clearContext=function(){return this.canvas2DContext.clearRect(0,0,this.getWidth()/this.zoomManager.getScale(),this.getHeight()/this.zoomManager.getScale()),this},e.prototype.requestRenderAll=function(t){var e=this;return this.renderingRequestId||(this.renderingRequestId=this.requestFrameAnimationApply(function(){e.renderAll()})),this},e.prototype.render=function(){var t=this;this.storageManager.getTree(),this.zoomManager.setScale(this.zoomManager.getScaleWithAllObjects()),this.scrollManager.toCenter(),this.renderAllCallback=function(){t.createScreenShot()},this.requestRenderAll()},e.prototype.renderAll=function(){this.renderingRequestId&&(this.cancelAnimationFrameApply(this.renderingRequestId),this.renderingRequestId=0),this.eventManager.sendEvent("beforeRenderAll"),this.clearContext();for(var t=this.scrollManager.getScrollLeft(),e=this.scrollManager.getScrollTop(),n=this.getWidth()/this.zoomManager.getScale(),o=this.getHeight()/this.zoomManager.getScale(),i=-t,s=-e,r=0,a=this.storageManager.findNodesByBoundingRect(null,{left:i,top:s,right:i+n,bottom:s+o});r<a.length;r++)for(var c=0,h=a[r].getObjects();c<h.length;c++){h[c].render(this)}"function"==typeof this.renderAllCallback&&(this.renderAllCallback.apply(window,[]),this.renderAllCallback=null),this.eventManager.sendEvent("afterRenderAll")},e.prototype.addObject=function(t){this.storageManager.addObject(t)},e.prototype.removeObject=function(t){this.storageManager.removeObject(t)},e.prototype.removeObjects=function(){this.storageManager.removeObjects()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getCanvas2DContext=function(){return this.canvas2DContext},e.prototype.setCursorStyle=function(t){return this.canvas.style.cursor=t,this},e.prototype.getObjects=function(){return this.storageManager.getObjects()},e.prototype.getDefaultCursorStyle=function(){return this.defaultCursorStyle},e.prototype.disableCanvasSelection=function(){for(var t=0,e=["-webkit-touch-callout","-webkit-user-select","-khtml-user-select","-moz-user-select","-ms-user-select","user-select","outline"];t<e.length;t++){var n=e[t];this.canvas.style[n]="none"}},e.prototype.drawScreenShot=function(t,e){if(!this.screenShotStorage)return!1;var n=this.screenShotStorage;this.clearContext();var o=this.zoomManager.getScale(),i=this.storageManager.getObjectsBoundingRect(),s=i.right*o,r=i.bottom*o;this.canvas2DContext.save(),this.canvas2DContext.scale(1/o,1/o),this.canvas2DContext.drawImage(n.getCanvas(),t,e,s,r),this.canvas2DContext.restore()},e.prototype.createScreenShot=function(){var t=this.storageManager.getImageStorage("screen-shot"),e=this.storageManager.getObjectsBoundingRect(),n=this.zoomManager.getScale(),o=e.right*n,i=e.bottom*n,s=this.canvas2DContext.getImageData(this.scrollManager.getScrollLeft()*n,this.scrollManager.getScrollTop()*n,o,i);t.setImageData(s,o,i),this.screenShotStorage=t},e.prototype.setFakeSchemeRatio=function(t){this.fakeSchemeRatio=t},e.prototype.getFakeSchemeRatio=function(){return this.fakeSchemeRatio},e.prototype.useFakeScheme=function(){var t=this.storageManager.getObjectsDimensions().width*this.zoomManager.getScale()/this.width;return!!(this.fakeSchemeRatio&&t<=this.fakeSchemeRatio)},e}();t.Scheme=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function e(e){this.isHovered=!1,this.cursorStyle="pointer",t.Tools.configure(this,e),this.params=e}return e.prototype.render=function(t){"function"==typeof this.renderFunction&&this.renderFunction(this,t)},e.prototype.click=function(e,n){"function"==typeof this.clickFunction&&this.clickFunction(this,t.Scheme,e)},e.prototype.mouseOver=function(e,n){"function"==typeof this.mouseOverFunction&&this.mouseOverFunction(this,t.Scheme,e)},e.prototype.mouseLeave=function(e,n){"function"==typeof this.mouseLeaveFunction&&this.mouseLeaveFunction(this,t.Scheme,e)},e.prototype.setX=function(t){this.x=t},e.prototype.setY=function(t){this.y=t},e.prototype.setWidth=function(t){this.width=t},e.prototype.setHeight=function(t){this.height=t},e.prototype.setCursorStyle=function(t){this.cursorStyle=t},e.prototype.setRenderFunction=function(t){this.renderFunction=t},e.prototype.setClickFunction=function(t){this.clickFunction=t},e.prototype.setMouseOverFunction=function(t){this.mouseOverFunction=t},e.prototype.setMouseLeaveFunction=function(t){this.mouseLeaveFunction=t},e.prototype.getRelativeX=function(t){return this.x+t.getScrollManager().getScrollLeft()},e.prototype.getRelativeY=function(t){return this.y+t.getScrollManager().getScrollTop()},e.prototype.getBoundingRect=function(){return{left:this.x,top:this.y,right:this.x+this.width,bottom:this.y+this.height}},e}();t.SchemeObject=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function e(e,n){this.id="scheme-designer-image-storage-"+t.Tools.getRandomString()+"-"+e,this.scheme=n;var o=document.getElementById(e);o||((o=document.createElement("canvas")).id=this.id,o.style.display="none",this.scheme.getCanvas().parentNode.appendChild(o)),this.canvas=o,this.context=this.canvas.getContext("2d")}return e.prototype.setImageData=function(t,e,n){this.canvas.width=e,this.canvas.height=n,this.context.putImageData(t,0,0)},e.prototype.getCanvas=function(){return this.canvas},e.prototype.getContext=function(){return this.context},e}();t.ImageStorage=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(){}return t.getRequestAnimationFrameFunction=function(){for(var t=0,e=["requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"];t<e.length;t++){var n=e[t];if(window.hasOwnProperty(n))return window[n]}return function(t){return window.setTimeout(t,1e3/60)}},t.getCancelAnimationFunction=function(){return window.cancelAnimationFrame||window.clearTimeout},t.getDevicePixelRatio=function(){for(var t=0,e=["devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio"];t<e.length;t++){var n=e[t];if(window.hasOwnProperty(n))return window[n]}return 1},t}();t.Polyfill=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(){}return t.configure=function(e,n){if(n)for(var o in n){var i=n[o],s="set"+t.capitalizeFirstLetter(o);"function"==typeof e[s]&&e[s].apply(e,[i])}},t.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.clone=function(t){return JSON.parse(JSON.stringify(t))},t.pointInRect=function(t,e){var n=!1;return e.left<=t.x&&e.right>=t.x&&e.top<=t.y&&e.bottom>=t.y&&(n=!0),n},t.rectIntersectRect=function(t,e){return!(t.top>e.bottom||t.bottom<e.top||t.right<e.left||t.left>e.right)},t.filterObjectsByBoundingRect=function(t,e){for(var n=[],o=0,i=e;o<i.length;o++){var s=i[o],r=s.getBoundingRect();this.rectIntersectRect(r,t)&&n.push(s)}return n},t.parseMaxStyle=function(t,e,n){var o;return"string"==typeof t?(o=parseInt(t,10),-1!==t.indexOf("%")&&(o=o/100*e.parentNode[n])):o=t,o},t.isConstrainedValue=function(t){return null!=t&&"none"!==t},t.getConstraintDimension=function(t,e,n){var o=document.defaultView,i=t.parentNode,s=o.getComputedStyle(t)[e],r=o.getComputedStyle(i)[e],a=this.isConstrainedValue(s),c=this.isConstrainedValue(r),h=Number.POSITIVE_INFINITY;return a||c?Math.min(a?this.parseMaxStyle(s,t,n):h,c?this.parseMaxStyle(r,i,n):h):null},t.getConstraintWidth=function(t){return this.getConstraintDimension(t,"max-width","clientWidth")},t.getConstraintHeight=function(t){return this.getConstraintDimension(t,"max-height","clientHeight")},t.getMaximumWidth=function(t){var e=t.parentNode;if(!e)return t.clientWidth;var n=parseInt(this.getStyle(e,"padding-left"),10),o=parseInt(this.getStyle(e,"padding-right"),10),i=e.clientWidth-n-o,s=this.getConstraintWidth(t);return s?Math.min(i,s):i},t.getMaximumHeight=function(t){var e=t.parentNode;if(!e)return t.clientHeight;var n=parseInt(this.getStyle(e,"padding-top"),10),o=parseInt(this.getStyle(e,"padding-bottom"),10),i=e.clientHeight-n-o,s=this.getConstraintHeight(t);return s?Math.min(i,s):i},t.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,null).getPropertyValue(e)},t.touchSupported=function(){return"ontouchstart"in window},t.sortObject=function(t){var e=Object.keys(t),n=e.length;e.sort();for(var o={},i=0;i<n;i++){var s=e[i];o[s]=t[s]}return o},t.getRandomString=function(){return Math.random().toString(36).substr(2,9)},t}();t.Tools=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(t){this.isDragging=!1,this.leftButtonDown=!1,this.hoveredObjects=[],this.scheme=t,this.setLastClientPosition({x:this.scheme.getWidth()/2,y:this.scheme.getHeight()/2})}return t.prototype.bindEvents=function(){var t=this;this.scheme.getCanvas().addEventListener("mousedown",function(e){t.onMouseDown(e)}),this.scheme.getCanvas().addEventListener("mouseup",function(e){t.onMouseUp(e)}),this.scheme.getCanvas().addEventListener("click",function(e){t.onClick(e)}),this.scheme.getCanvas().addEventListener("dblclick",function(e){t.onDoubleClick(e)}),this.scheme.getCanvas().addEventListener("mousemove",function(e){t.onMouseMove(e)}),this.scheme.getCanvas().addEventListener("mouseout",function(e){t.onMouseOut(e)}),this.scheme.getCanvas().addEventListener("mouseenter",function(e){t.onMouseEnter(e)}),this.scheme.getCanvas().addEventListener("contextmenu",function(e){t.onContextMenu(e)}),this.scheme.getCanvas().addEventListener("mousewheel",function(e){t.onMouseWheel(e)}),this.scheme.getCanvas().addEventListener("DOMMouseScroll",function(e){t.onMouseWheel(e)}),this.scheme.getCanvas().addEventListener("touchstart",function(e){t.touchDistance=0,t.onMouseDown(e)}),this.scheme.getCanvas().addEventListener("touchmove",function(e){if(1==e.targetTouches.length)t.onMouseMove(e);else if(2==e.targetTouches.length){var n=e.targetTouches[0],o=e.targetTouches[1],i=Math.sqrt(Math.pow(o.pageX-n.pageX,2)+Math.pow(o.pageY-n.pageY,2)),s=0;t.touchDistance&&(s=i-t.touchDistance),t.touchDistance=i,s&&t.scheme.getZoomManager().zoomToPointer(e,s/5)}e.preventDefault()}),this.scheme.getCanvas().addEventListener("touchend",function(e){t.onMouseUp(e)}),this.scheme.getCanvas().addEventListener("touchcancel",function(e){t.onMouseUp(e)}),window.addEventListener("resize",function(e){var n=t.scheme.getZoomManager().getScale();t.scheme.resize(),t.scheme.requestRenderAll(),t.scheme.getZoomManager().zoomByFactor(n)||t.scheme.getZoomManager().setScale(t.scheme.getZoomManager().getScaleWithAllObjects())})},t.prototype.onMouseDown=function(t){this.leftButtonDown=!0,this.setLastClientPositionFromEvent(t)},t.prototype.onMouseUp=function(t){var e=this;this.leftButtonDown=!1,this.setLastClientPositionFromEvent(t),this.isDragging&&(this.scheme.setCursorStyle(this.scheme.getDefaultCursorStyle()),this.scheme.requestRenderAll()),setTimeout(function(){e.isDragging=!1},10)},t.prototype.onClick=function(t){if(!this.isDragging){for(var e=this.findObjectsForEvent(t),n=0,o=e;n<o.length;n++){var i=o[n];i.click(t,this.scheme),this.sendEvent("clickOnObject",i)}e.length&&this.scheme.requestRenderAll()}},t.prototype.onDoubleClick=function(t){this.scheme.getZoomManager().zoomToPointer(t,14)},t.prototype.onContextMenu=function(t){},t.prototype.onMouseMove=function(t){if(this.leftButtonDown){var e=this.getCoordinatesFromEvent(t),n=Math.abs(e.x-this.getLastClientX()),o=Math.abs(e.y-this.getLastClientY());(n>1||o>1)&&(this.isDragging=!0,this.scheme.setCursorStyle("move"))}this.isDragging?this.scheme.getScrollManager().handleDragging(t):this.handleHover(t)},t.prototype.getPointer=function(t,e){var n="touchend"===t.type?"changedTouches":"touches",o=t;return o[n]&&o[n][0]?2==o[n].length?(o[n][0][e]+o[n][1][e])/2:o[n][0][e]:o[e]},t.prototype.handleHover=function(t){this.setLastClientPositionFromEvent(t);var e=this.findObjectsForEvent(t),n=!1,o=!1;if(this.hoveredObjects.length)for(var i=0,s=this.hoveredObjects;i<s.length;i++){for(var r=s[i],a=!1,c=0,h=e;c<h.length;c++){(l=h[c])==r&&(a=!0)}a||(r.isHovered=!1,r.mouseLeave(t,this.scheme),this.sendEvent("mouseLeaveObject",r),n=!0,o=!0)}if(!this.hoveredObjects.length||o)for(var g=0,u=e;g<u.length;g++){var l;(l=u[g]).isHovered=!0,n=!0,this.scheme.setCursorStyle(l.cursorStyle),l.mouseOver(t,this.scheme),this.sendEvent("mouseOverObject",l)}this.hoveredObjects=e,e.length||this.scheme.setCursorStyle(this.scheme.getDefaultCursorStyle()),n&&this.scheme.requestRenderAll()},t.prototype.onMouseOut=function(t){this.setLastClientPositionFromEvent(t),this.leftButtonDown=!1,this.isDragging=!1,this.scheme.requestRenderAll()},t.prototype.onMouseEnter=function(t){},t.prototype.onMouseWheel=function(t){return this.scheme.getZoomManager().handleMouseWheel(t)},t.prototype.setLastClientPositionFromEvent=function(t){var e=this.getCoordinatesFromEvent(t);this.setLastClientPosition(e)},t.prototype.findObjectsForEvent=function(t){var e=this.getCoordinatesFromEvent(t);return this.scheme.getStorageManager().findObjectsByCoordinates(e)},t.prototype.getCoordinatesFromEvent=function(t){var e=this.scheme.getCanvas().getBoundingClientRect();return{x:this.getPointer(t,"clientX")-e.left,y:this.getPointer(t,"clientY")-e.top}},t.prototype.setLastClientPosition=function(t){this.lastClientPosition=t},t.prototype.getLastClientX=function(){return this.lastClientPosition.x},t.prototype.getLastClientY=function(){return this.lastClientPosition.y},t.prototype.sendEvent=function(t,e){var n="schemeDesigner."+t;if("function"==typeof CustomEvent){var o=new CustomEvent(n,{detail:e});this.scheme.getCanvas().dispatchEvent(o)}else{var i=document.createEvent("CustomEvent");i.initCustomEvent(n,!1,!1,e),this.scheme.getCanvas().dispatchEvent(i)}},t}();t.EventManager=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(t){this.scrollLeft=0,this.scrollTop=0,this.maxHiddenPart=.85,this.scheme=t}return t.prototype.getScrollLeft=function(){return this.scrollLeft},t.prototype.getScrollTop=function(){return this.scrollTop},t.prototype.scroll=function(t,e){var n=this,o=this.scheme.getStorageManager().getObjectsBoundingRect(),i=this.scheme.getZoomManager().getScale(),s=this.scheme.getWidth()/i-o.left,r=this.scheme.getHeight()/i-o.top,a=-o.right,c=-o.bottom;s*=this.maxHiddenPart,r*=this.maxHiddenPart,a*=this.maxHiddenPart,c*=this.maxHiddenPart,t>s&&(t=s),e>r&&(e=r),t<a&&(t=a),e<c&&(e=c),this.scrollLeft=t,this.scrollTop=e,this.scheme.useFakeScheme()?this.scheme.requestFrameAnimationApply(function(){n.scheme.drawScreenShot(t*i,e*i)}):this.scheme.requestRenderAll(),this.scheme.getEventManager().sendEvent("scroll",{left:t,top:e,maxScrollLeft:s,maxScrollTop:r,minScrollLeft:a,minScrollTop:c,boundingRect:o,scale:i})},t.prototype.toCenter=function(){var t=this.scheme.getStorageManager().getObjectsBoundingRect(),e=(t.right-t.left)*this.scheme.getZoomManager().getScale(),n=(t.bottom-t.top)*this.scheme.getZoomManager().getScale(),o=this.scheme.getWidth()-e,i=this.scheme.getHeight()-n,s=o/2/this.scheme.getZoomManager().getScale(),r=i/2/this.scheme.getZoomManager().getScale();s-=t.left,r-=t.top,this.scroll(s,r)},t.prototype.handleDragging=function(t){var e=this.scheme.getEventManager().getLastClientX(),n=this.scheme.getEventManager().getLastClientY();this.scheme.getEventManager().setLastClientPositionFromEvent(t);var o=this.scheme.getEventManager().getLastClientX()-e,i=this.scheme.getEventManager().getLastClientY()-n;o/=this.scheme.getZoomManager().getScale(),i/=this.scheme.getZoomManager().getScale();var s=o+this.getScrollLeft(),r=i+this.getScrollTop();this.scroll(s,r)},t.prototype.setMaxHiddenPart=function(t){this.maxHiddenPart=t},t}();t.ScrollManager=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function e(t){this.treeDepth=6,this.scheme=t,this.objects=[]}return e.prototype.getObjects=function(){return this.objects},e.prototype.addObject=function(t){this.objects.push(t),this.reCalcObjectsBoundingRect(),this.requestBuildTree()},e.prototype.removeObject=function(t){this.objects.filter(function(e){return e!==t}),this.reCalcObjectsBoundingRect(),this.requestBuildTree()},e.prototype.removeObjects=function(){this.objects=[],this.requestBuildTree()},e.prototype.findObjectsByCoordinates=function(e){var n=[],o=e.x,i=e.y;o/=this.scheme.getZoomManager().getScale(),i/=this.scheme.getZoomManager().getScale(),o-=this.scheme.getScrollManager().getScrollLeft(),i-=this.scheme.getScrollManager().getScrollTop();var s=this.getTree(),r=this.findNodeByCoordinates(s,{x:o,y:i}),a=[];r&&(a=r.getObjects());for(var c=0,h=a;c<h.length;c++){var g=h[c],u=g.getBoundingRect();t.Tools.pointInRect({x:o,y:i},u)&&n.push(g)}return n},e.prototype.getObjectsBoundingRect=function(){return this.objectsBoundingRect||(this.objectsBoundingRect=this.calculateObjectsBoundingRect()),this.objectsBoundingRect},e.prototype.getObjectsDimensions=function(){var t=this.getObjectsBoundingRect();return{width:t.right-t.left,height:t.bottom-t.top}},e.prototype.reCalcObjectsBoundingRect=function(){this.objectsBoundingRect=null},e.prototype.calculateObjectsBoundingRect=function(){for(var t,e,n,o,i=0,s=this.objects;i<s.length;i++){var r=s[i].getBoundingRect();(null==t||r.top<t)&&(t=r.top),(null==e||r.left<e)&&(e=r.left),(null==n||r.right>n)&&(n=r.right),(null==o||r.bottom>o)&&(o=r.bottom)}return{left:e,top:t,right:n,bottom:o}},e.prototype.setTreeDepth=function(t){this.treeDepth=t},e.prototype.requestBuildTree=function(){this.rootTreeNode=null},e.prototype.getTree=function(){return this.rootTreeNode||(this.rootTreeNode=this.buildTree()),this.rootTreeNode},e.prototype.buildTree=function(){var t=this.getObjectsBoundingRect();return this.rootTreeNode=new n(null,t,this.objects,0),this.explodeTreeNodes(this.rootTreeNode,this.treeDepth),this.rootTreeNode},e.prototype.explodeTreeNodes=function(t,e){if(this.explodeTreeNode(t),--e>0)for(var n=0,o=t.getChildren();n<o.length;n++){var i=o[n];this.explodeTreeNodes(i,e)}},e.prototype.explodeTreeNode=function(e){var o=e.getBoundingRect(),i=e.getDepth()+1,s=t.Tools.clone(o),r=t.Tools.clone(o);if(i%2==1){var a=(o.right-o.left)/2;s.right=s.right-a,r.left=r.left+a}else{a=(o.bottom-o.top)/2;s.bottom=s.bottom-a,r.top=r.top+a}var c=t.Tools.filterObjectsByBoundingRect(s,e.getObjects()),h=t.Tools.filterObjectsByBoundingRect(r,e.getObjects()),g=new n(e,s,c,i),u=new n(e,r,h,i);e.addChild(g),e.addChild(u),e.removeObjects()},e.prototype.findNodeByCoordinates=function(t,e){var n=t.getChildByCoordinates(e);return n?n.isLastNode()?n:this.findNodeByCoordinates(n,e):null},e.prototype.findNodesByBoundingRect=function(t,e){t||(t=this.getTree());for(var n=[],o=0,i=t.getChildrenByBoundingRect(e);o<i.length;o++){var s=i[o];if(s.isLastNode())n.push(s);else for(var r=0,a=this.findNodesByBoundingRect(s,e);r<a.length;r++){var c=a[r];n.push(c)}}return n},e.prototype.showNodesParts=function(){for(var t=this.getTree().getLastChildren(),e=this.scheme.getCanvas2DContext(),n=0,o=t;n<o.length;n++){var i=o[n],s=i.getBoundingRect().left+this.scheme.getScrollManager().getScrollLeft(),r=i.getBoundingRect().top+this.scheme.getScrollManager().getScrollTop(),a=i.getBoundingRect().right-i.getBoundingRect().left,c=i.getBoundingRect().bottom-i.getBoundingRect().top;e.lineWidth=1,e.strokeStyle="black",e.rect(s,r,a,c),e.stroke()}},e.prototype.getImageStorage=function(e){return new t.ImageStorage(e,this.scheme)},e}();t.StorageManager=e;var n=function(){function e(t,e,n,o){this.children=[],this.objects=[],this.parent=t,this.boundingRect=e,this.objects=n,this.depth=o}return e.prototype.addChild=function(t){this.children.push(t)},e.prototype.getObjects=function(){return this.objects},e.prototype.getChildren=function(){return this.children},e.prototype.isLastNode=function(){return this.objects.length>0},e.prototype.getLastChildren=function(){for(var t=[],e=0,n=this.children;e<n.length;e++){var o=n[e];if(o.isLastNode())t.push(o);else for(var i=0,s=o.getLastChildren();i<s.length;i++){var r=s[i];t.push(r)}}return t},e.prototype.getChildByCoordinates=function(e){for(var n=0,o=this.children;n<o.length;n++){var i=o[n];if(t.Tools.pointInRect(e,i.getBoundingRect()))return i}return null},e.prototype.getChildrenByBoundingRect=function(e){for(var n=[],o=0,i=this.children;o<i.length;o++){var s=i[o];t.Tools.rectIntersectRect(s.getBoundingRect(),e)&&n.push(s)}return n},e.prototype.removeObjects=function(){this.objects=[]},e.prototype.getBoundingRect=function(){return this.boundingRect},e.prototype.getDepth=function(){return this.depth},e}();t.TreeNode=n}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(t){this.scale=1,this.zoomCoefficient=1.04,this.padding=.1,this.maxScale=5,this.scheme=t}return t.prototype.zoom=function(t){var e=Math.pow(this.zoomCoefficient,t);return this.zoomByFactor(e)},t.prototype.setScale=function(t){var e=this.scale/t;return this.zoomByFactor(e)},t.prototype.getScaleWithAllObjects=function(){var t=this.scheme.getStorageManager().getObjectsBoundingRect(),e=(t.right-t.left)*(this.padding+1)/this.scheme.getWidth(),n=(t.bottom-t.top)*(this.padding+1)/this.scheme.getHeight();return e>n?e:n},t.prototype.zoomByFactor=function(t){var e=this;this.renderAllTimer&&clearTimeout(this.renderAllTimer);var n=this.scheme.getStorageManager().getObjectsBoundingRect(),o=!0,i=!0,s=this.scale,r=s*t;return t<1?(o=this.scheme.getWidth()*(1-this.padding)<n.right*r,i=this.scheme.getHeight()*(1-this.padding)<n.bottom*r):(o=this.scheme.getWidth()*this.maxScale>n.right*r,i=this.scheme.getHeight()*this.maxScale>n.bottom*r),!(!o&&!i)&&(this.scheme.getCanvas2DContext().scale(t,t),this.scale=r,this.scheme.useFakeScheme()?(this.scheme.drawScreenShot(this.scheme.getScrollManager().getScrollLeft(),this.scheme.getScrollManager().getScrollTop()),setTimeout(function(){e.scheme.requestRenderAll()},50)):this.scheme.requestRenderAll(),this.scheme.getEventManager().sendEvent("zoom",{oldScale:s,newScale:r}),!0)},t.prototype.getScale=function(){return this.scale},t.prototype.resetScale=function(){this.scale=1},t.prototype.handleMouseWheel=function(t){var e=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;return e&&this.zoomToPointer(t,e),t.preventDefault()&&!1},t.prototype.zoomToPointer=function(t,e){this.scheme.getEventManager().setLastClientPositionFromEvent(t),this.zoomToPoint({x:this.scheme.getEventManager().getLastClientX(),y:this.scheme.getEventManager().getLastClientY()},e)},t.prototype.zoomToCenter=function(t){this.zoomToPoint({x:this.scheme.getWidth()/2,y:this.scheme.getHeight()/2},t)},t.prototype.zoomToPoint=function(t,e){var n=this.scheme.getZoomManager().getScale();if(this.scheme.getZoomManager().zoom(e)){var o=this.scheme.getZoomManager().getScale(),i=t.x/n,s=t.y/n,r=t.x/o-i,a=t.y/o-s;this.scheme.getScrollManager().scroll(this.scheme.getScrollManager().getScrollLeft()+r,this.scheme.getScrollManager().getScrollTop()+a)}},t.prototype.setPadding=function(t){this.padding=t},t.prototype.setMaxScale=function(t){this.maxScale=t},t.prototype.setZoomCoefficient=function(t){this.zoomCoefficient=t},t}();t.ZoomManager=e}(SchemeDesigner||(SchemeDesigner={}));