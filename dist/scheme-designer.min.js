/**
 * https://github.com/NikitchenkoSergey/scheme-designer         Generated on 08/15/2019        Author: Nikitchenko Sergey <nikitchenko.sergey@yandex.ru>
 */

var SchemeDesigner;!function(i){var t=function(){function t(t,e){if(this.zIndex=0,this.active=!0,this.visible=!0,this.objects=[],0==t.length)throw new Error("Empty layer id");this.id=t,i.Tools.configure(this,e)}return t.prototype.removeObject=function(e){this.objects.filter(function(t){return t!==e})},t.prototype.removeObjects=function(){this.objects=[]},t.prototype.getObjects=function(){return this.objects},t.prototype.addObject=function(t){t.setLayerId(this.id),this.objects.push(t)},t.prototype.setZIndex=function(t){this.zIndex=t},t.prototype.setActive=function(t){this.active=t},t.prototype.setVisible=function(t){this.visible=t},t.prototype.isVisible=function(){return this.visible},t.prototype.isActive=function(){return this.active},t.prototype.getZIndex=function(){return this.zIndex},t.prototype.getId=function(){return this.id},t}();i.Layer=t}(SchemeDesigner||(SchemeDesigner={})),function(d){var t=function(){function t(t,e){this.renderingRequestId=0,this.devicePixelRatio=1,this.defaultCursorStyle="default",this.cacheSchemeRatio=2,this.background=null,this.changedObjects=[],this.requestFrameAnimation=d.Polyfill.getRequestAnimationFrameFunction(),this.cancelFrameAnimation=d.Polyfill.getCancelAnimationFunction(),this.devicePixelRatio=d.Polyfill.getDevicePixelRatio(),e&&d.Tools.configure(this,e.options),this.view=new d.View(t,this.background),this.scrollManager=new d.ScrollManager(this),this.zoomManager=new d.ZoomManager(this),this.eventManager=new d.EventManager(this),this.mapManager=new d.MapManager(this),this.storageManager=new d.StorageManager(this),e&&(d.Tools.configure(this.scrollManager,e.scroll),d.Tools.configure(this.zoomManager,e.zoom),d.Tools.configure(this.mapManager,e.map),d.Tools.configure(this.storageManager,e.storage),d.Tools.configure(this.eventManager,e.event)),d.Tools.disableElementSelection(this.view.getCanvas()),this.resize()}return t.prototype.resize=function(){this.view.resize(),this.mapManager.resize(),this.zoomManager.resetScale()},t.prototype.getEventManager=function(){return this.eventManager},t.prototype.getScrollManager=function(){return this.scrollManager},t.prototype.getZoomManager=function(){return this.zoomManager},t.prototype.getStorageManager=function(){return this.storageManager},t.prototype.getMapManager=function(){return this.mapManager},t.prototype.getWidth=function(){return this.view.getWidth()},t.prototype.getHeight=function(){return this.view.getHeight()},t.prototype.requestFrameAnimationApply=function(t){return this.requestFrameAnimation.call(window,t)},t.prototype.cancelAnimationFrameApply=function(t){return this.cancelFrameAnimation.call(window,t)},t.prototype.clearContext=function(){var t=this.view.getContext();return t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.getWidth(),this.getHeight()),t.restore(),this},t.prototype.requestRenderAll=function(){var t=this;return this.renderingRequestId||(this.renderingRequestId=this.requestFrameAnimationApply(function(){t.renderAll()})),this},t.prototype.render=function(){this.storageManager.getTree(),this.zoomManager.setScale(this.zoomManager.getScaleWithAllObjects()),this.scrollManager.toCenter(),this.updateCache(!1),this.requestDrawFromCache()},t.prototype.getVisibleBoundingRect=function(){var t=this.zoomManager.getScale(),e=this.getWidth()/t,i=this.getHeight()/t,n=-this.scrollManager.getScrollLeft()/t,o=-this.scrollManager.getScrollTop()/t;return{left:n,top:o,right:n+e,bottom:o+i}},t.prototype.renderAll=function(){this.renderingRequestId&&(this.cancelAnimationFrameApply(this.renderingRequestId),this.renderingRequestId=0),this.eventManager.sendEvent("beforeRenderAll"),this.clearContext(),this.view.drawBackground();for(var t=this.getVisibleBoundingRect(),e=this.storageManager.findNodesByBoundingRect(null,t),i={},n=0,o=this.storageManager.getSortedLayers();n<o.length;n++)for(var s=o[n],r=0,a=e;r<a.length;r++)for(var h=0,c=a[r].getObjectsByLayer(s.getId());h<c.length;h++){var u=c[h],g=u.getId();void 0===i[g]&&(i[g]=!0,u.render(this,this.view))}this.mapManager.drawMap(),this.eventManager.sendEvent("afterRenderAll")},t.prototype.addLayer=function(t){this.storageManager.addLayer(t)},t.prototype.removeLayer=function(t){this.storageManager.removeLayer(t)},t.prototype.getCanvas=function(){return this.view.getCanvas()},t.prototype.setCursorStyle=function(t){return this.view.getCanvas().style.cursor=t,this},t.prototype.getDefaultCursorStyle=function(){return this.defaultCursorStyle},t.prototype.drawFromCache=function(){if(!this.cacheView)return!1;this.renderingRequestId&&(this.cancelAnimationFrameApply(this.renderingRequestId),this.renderingRequestId=0),this.clearContext();var t=this.storageManager.getObjectsBoundingRect();return this.view.drawBackground(),this.view.getContext().drawImage(this.cacheView.getCanvas(),0,0,t.right,t.bottom),this.mapManager.drawMap(),!0},t.prototype.requestDrawFromCache=function(){var t=this;return this.renderingRequestId||(this.renderingRequestId=this.requestFrameAnimationApply(function(){t.drawFromCache()})),this},t.prototype.updateCache=function(t){if(!this.cacheView){var e=this.storageManager.getImageStorage("scheme-cache");this.cacheView=new d.View(e.getCanvas(),this.background)}if(t)for(var i=0,n=this.changedObjects;i<n.length;i++){var o=n[i];(g=this.storageManager.getLayerById(o.getLayerId()))instanceof d.Layer&&g.isVisible()&&(o.clear(this,this.cacheView),o.render(this,this.cacheView))}else{var s=this.storageManager.getObjectsBoundingRect(),r=1/this.zoomManager.getScaleWithAllObjects()*this.cacheSchemeRatio,a=s.right*r,h=s.bottom*r;this.cacheView.setDimensions({width:a,height:h}),this.cacheView.getContext().scale(r,r),this.cacheView.drawBackground();for(var c=0,u=this.storageManager.getSortedLayers();c<u.length;c++)for(var g,l=0,p=(g=u[c]).getObjects();l<p.length;l++){(o=p[l]).render(this,this.cacheView)}}this.changedObjects=[]},t.prototype.addChangedObject=function(t){this.changedObjects.push(t)},t.prototype.setCacheSchemeRatio=function(t){this.cacheSchemeRatio=t},t.prototype.getCAcheSchemeRatio=function(){return this.cacheSchemeRatio},t.prototype.useSchemeCache=function(){var t=this.storageManager.getObjectsDimensions().width*this.zoomManager.getScale()/this.getWidth();return!!(this.cacheSchemeRatio&&t<=this.cacheSchemeRatio)},t.prototype.getView=function(){return this.view},t.prototype.getCacheView=function(){return this.cacheView},t.prototype.setBackground=function(t){this.background=t},t.prototype.getBackground=function(){return this.background},t}();d.Scheme=t}(SchemeDesigner||(SchemeDesigner={})),function(r){var t=function(){function t(t){this.active=!0,this.rotation=0,this.isHovered=!1,this.cursorStyle="pointer",this.renderFunction=function(){},this.clearFunction=function(){},this.id=r.Tools.generateUniqueId(),r.Tools.configure(this,t),this.params=t}return t.prototype.setLayerId=function(t){this.layerId=t},t.prototype.getLayerId=function(){return this.layerId},t.prototype.getId=function(){return this.id},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.getParams=function(){return this.params},t.prototype.render=function(t,e){this.renderFunction(this,t,e)},t.prototype.clear=function(t,e){this.clearFunction(this,t,e)},t.prototype.click=function(t,e,i){return"function"==typeof this.clickFunction?this.clickFunction(this,e,i,t):null},t.prototype.mouseOver=function(t,e,i){return"function"==typeof this.mouseOverFunction?this.mouseOverFunction(this,e,i,t):null},t.prototype.mouseLeave=function(t,e,i){return"function"==typeof this.mouseLeaveFunction?this.mouseLeaveFunction(this,e,i,t):null},t.prototype.checkPointInObject=function(t,e,i){return"function"!=typeof this.pointInObjectFunction||this.pointInObjectFunction(this,t,e,i)},t.prototype.setX=function(t){this.x=t},t.prototype.setY=function(t){this.y=t},t.prototype.setWidth=function(t){this.width=t},t.prototype.setHeight=function(t){this.height=t},t.prototype.setCursorStyle=function(t){this.cursorStyle=t},t.prototype.setRotation=function(t){this.rotation=t},t.prototype.setRenderFunction=function(t){this.renderFunction=t},t.prototype.setClickFunction=function(t){this.clickFunction=t},t.prototype.setClearFunction=function(t){this.clearFunction=t},t.prototype.setMouseOverFunction=function(t){this.mouseOverFunction=t},t.prototype.setMouseLeaveFunction=function(t){this.mouseLeaveFunction=t},t.prototype.setPointInObjectFunction=function(t){this.pointInObjectFunction=t},t.prototype.getBoundingRect=function(){return{left:this.x,top:this.y,right:this.x+this.width,bottom:this.y+this.height}},t.prototype.getOuterBoundingRect=function(){var t=this.getBoundingRect();if(!this.rotation)return t;var e={x:(t.left+t.right)/2,y:(t.top+t.bottom)/2},i=r.Tools.rotatePointByAxis({x:this.x,y:this.y},e,this.rotation),n=r.Tools.rotatePointByAxis({x:this.x,y:this.y+this.height},e,this.rotation),o=r.Tools.rotatePointByAxis({x:this.x+this.width,y:this.y},e,this.rotation),s=r.Tools.rotatePointByAxis({x:this.x+this.width,y:this.y+this.height},e,this.rotation);return{left:Math.min(i.x,n.x,o.x,s.x),top:Math.min(i.y,n.y,o.y,s.y),right:Math.max(i.x,n.x,o.x,s.x),bottom:Math.max(i.y,n.y,o.y,s.y)}},t.prototype.getRotation=function(){return this.rotation},t.prototype.isActive=function(){return this.active},t.prototype.setActive=function(t){this.active=t},t}();r.SchemeObject=t}(SchemeDesigner||(SchemeDesigner={})),function(n){var t=function(){function t(t,e){this.id="scheme-designer-image-storage-"+n.Tools.getRandomString()+"-"+t,this.scheme=e;var i=document.getElementById(t);i||((i=document.createElement("canvas")).id=this.id,i.style.display="none",this.scheme.getCanvas().parentNode.appendChild(i)),this.canvas=i,this.context=this.canvas.getContext("2d")}return t.prototype.setImageData=function(t,e,i){this.setDimensions({width:e,height:i}),this.context.putImageData(t,0,0)},t.prototype.setDimensions=function(t){this.canvas.width=t.width,this.canvas.height=t.height},t.prototype.getCanvas=function(){return this.canvas},t.prototype.getContext=function(){return this.context},t}();n.ImageStorage=t}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(){}return t.getRequestAnimationFrameFunction=function(){for(var t=0,e=["requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"];t<e.length;t++){var i=e[t];if(window.hasOwnProperty(i))return window[i]}return function(t){return window.setTimeout(t,1e3/60)}},t.getCancelAnimationFunction=function(){return window.cancelAnimationFrame||window.clearTimeout},t.getDevicePixelRatio=function(){for(var t=0,e=["devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio"];t<e.length;t++){var i=e[t];if(window.hasOwnProperty(i))return window[i]}return 1},t}();t.Polyfill=e}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function c(){}return c.configure=function(t,e){if(e)for(var i in e){var n=e[i],o="set"+c.capitalizeFirstLetter(i);"function"==typeof t[o]&&t[o].call(t,n)}},c.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},c.clone=function(t){return JSON.parse(JSON.stringify(t))},c.pointInRect=function(t,e,i){var n=!1,o=t.x,s=t.y;if(i){i=-i;var r=(e.left+e.right)/2,a=(e.top+e.bottom)/2,h=c.rotatePointByAxis(t,{x:r,y:a},i);o=h.x,s=h.y}return e.left<=o&&e.right>=o&&e.top<=s&&e.bottom>=s&&(n=!0),n},c.rotatePointByAxis=function(t,e,i){return i=i*Math.PI/180,{x:e.x+(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i),y:e.y+(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)}},c.rectIntersectRect=function(t,e){return!(t.top>e.bottom||t.bottom<e.top||t.right<e.left||t.left>e.right)},c.filterObjectsByBoundingRect=function(t,e){for(var i=[],n=0,o=e;n<o.length;n++){var s=o[n],r=s.getOuterBoundingRect();this.rectIntersectRect(r,t)&&i.push(s)}return i},c.filterLayersObjectsByBoundingRect=function(t,e){var i={};for(var n in e){var o=e[n];i[n]=c.filterObjectsByBoundingRect(t,o)}return i},c.parseMaxStyle=function(t,e,i){var n;return"string"==typeof t?(n=parseInt(t,10),-1!==t.indexOf("%")&&(n=n/100*e.parentNode[i])):n=t,n},c.isConstrainedValue=function(t){return null!=t&&"none"!==t},c.getConstraintDimension=function(t,e,i){var n=document.defaultView,o=t.parentNode,s=n.getComputedStyle(t)[e],r=n.getComputedStyle(o)[e],a=this.isConstrainedValue(s),h=this.isConstrainedValue(r),c=Number.POSITIVE_INFINITY;return a||h?Math.min(a?this.parseMaxStyle(s,t,i):c,h?this.parseMaxStyle(r,o,i):c):null},c.getConstraintWidth=function(t){return this.getConstraintDimension(t,"max-width","clientWidth")},c.getConstraintHeight=function(t){return this.getConstraintDimension(t,"max-height","clientHeight")},c.getMaximumWidth=function(t){var e=t.parentNode;if(!e)return t.clientWidth;var i=parseInt(this.getStyle(e,"padding-left"),10),n=parseInt(this.getStyle(e,"padding-right"),10),o=e.clientWidth-i-n,s=this.getConstraintWidth(t);return s?Math.min(o,s):o},c.getMaximumHeight=function(t){var e=t.parentNode;if(!e)return t.clientHeight;var i=parseInt(this.getStyle(e,"padding-top"),10),n=parseInt(this.getStyle(e,"padding-bottom"),10),o=e.clientHeight-i-n,s=this.getConstraintHeight(t);return s?Math.min(o,s):o},c.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,null).getPropertyValue(e)},c.generateUniqueId=function(){return this.idNumber++,this.idNumber},c.touchSupported=function(){return"ontouchstart"in window},c.sortObject=function(t){var e=Object.keys(t),i=e.length;e.sort();for(var n={},o=0;o<i;o++){var s=e[o];n[s]=t[s]}return n},c.getRandomString=function(){return Math.random().toString(36).substr(2,9)},c.disableElementSelection=function(t){for(var e=0,i=["-webkit-touch-callout","-webkit-user-select","-khtml-user-select","-moz-user-select","-ms-user-select","user-select","outline"];e<i.length;e++){var n=i[e];t.style[n]="none"}},c.getPointer=function(t,e){var i="touchend"===t.type?"changedTouches":"touches",n=t;return n[i]&&n[i][0]?2==n[i].length?(n[i][0][e]+n[i][1][e])/2:n[i][0][e]:n[e]},c.idNumber=0,c}();t.Tools=e}(SchemeDesigner||(SchemeDesigner={})),function(i){var t=function(){function t(t,e){void 0===e&&(e=null),this.scrollLeft=0,this.scrollTop=0,this.scale=0,this.width=0,this.height=0,this.background=null,this.canvas=t,this.background=e,this.background?this.context=this.canvas.getContext("2d",{alpha:!1}):this.context=this.canvas.getContext("2d")}return t.prototype.getCanvas=function(){return this.canvas},t.prototype.getContext=function(){return this.context},t.prototype.setScrollLeft=function(t){this.scrollLeft=t},t.prototype.setScrollTop=function(t){this.scrollTop=t},t.prototype.setScale=function(t){this.scale=t},t.prototype.getScrollLeft=function(){return this.scrollLeft},t.prototype.getScrollTop=function(){return this.scrollTop},t.prototype.getScale=function(){return this.scale},t.prototype.setDimensions=function(t){this.canvas.width=t.width,this.canvas.height=t.height,this.width=t.width,this.height=t.height},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.applyTransformation=function(){this.context.setTransform(this.scale,0,0,this.scale,this.scrollLeft,this.scrollTop)},t.prototype.resize=function(){var t=Math.max(0,Math.floor(i.Tools.getMaximumWidth(this.getCanvas()))),e=Math.max(0,Math.floor(i.Tools.getMaximumHeight(this.getCanvas())));this.setDimensions({width:t,height:e})},t.prototype.drawBackground=function(){if(!this.background)return!1;var t=this.getContext();return t.fillStyle=this.background,t.save(),t.setTransform(1,0,0,1,0,0),t.fillRect(0,0,this.width,this.height),t.restore(),!0},t}();i.View=t}(SchemeDesigner||(SchemeDesigner={})),function(i){var t=function(){function t(t){this.isDragging=!1,this.leftButtonDown=!1,this.hoveredObjects=[],this.lastTouchEndTime=0,this.doubleTapDelay=300,this.scheme=t,this.setLastClientPosition({x:this.scheme.getWidth()/2,y:this.scheme.getHeight()/2}),this.bindEvents()}return t.prototype.bindEvents=function(){var s=this;this.scheme.getCanvas().addEventListener("mousedown",function(t){s.onMouseDown(t)}),this.scheme.getCanvas().addEventListener("mouseup",function(t){s.onMouseUp(t)}),this.scheme.getCanvas().addEventListener("click",function(t){s.onClick(t)}),this.scheme.getCanvas().addEventListener("dblclick",function(t){s.onDoubleClick(t)}),this.scheme.getCanvas().addEventListener("mousemove",function(t){s.onMouseMove(t)}),this.scheme.getCanvas().addEventListener("mouseout",function(t){s.onMouseOut(t)}),this.scheme.getCanvas().addEventListener("mouseenter",function(t){s.onMouseEnter(t)}),this.scheme.getCanvas().addEventListener("contextmenu",function(t){s.onContextMenu(t)}),this.scheme.getCanvas().addEventListener("mousewheel",function(t){s.onMouseWheel(t)}),this.scheme.getCanvas().addEventListener("DOMMouseScroll",function(t){s.onMouseWheel(t)}),this.scheme.getCanvas().addEventListener("touchstart",function(t){s.touchDistance=0,s.onMouseDown(t)}),this.scheme.getCanvas().addEventListener("touchmove",function(t){if(!t.targetTouches)return!1;if(1==t.targetTouches.length)s.onMouseMove(t);else if(2==t.targetTouches.length){var e=t.targetTouches[0],i=t.targetTouches[1],n=Math.sqrt(Math.pow(i.pageX-e.pageX,2)+Math.pow(i.pageY-e.pageY,2)),o=0;s.touchDistance&&(o=n-s.touchDistance),s.touchDistance=n,o&&s.scheme.getZoomManager().zoomToPointer(t,o/5)}t.preventDefault()}),this.scheme.getCanvas().addEventListener("touchend",function(t){var e=(new Date).getTime();s.lastTouchEndTime&&e-s.lastTouchEndTime<=s.doubleTapDelay?t.preventDefault():s.onMouseUp(t),s.lastTouchEndTime=e}),this.scheme.getCanvas().addEventListener("touchcancel",function(t){s.onMouseUp(t)}),window.addEventListener("resize",function(t){var e=s.scheme.getZoomManager().getScale();s.scheme.resize(),s.scheme.requestRenderAll(),s.scheme.getZoomManager().zoomByFactor(e)||s.scheme.getZoomManager().setScale(s.scheme.getZoomManager().getScaleWithAllObjects())})},t.prototype.onMouseDown=function(t){this.leftButtonDown=!0,this.setLastClientPositionFromEvent(t)},t.prototype.onMouseUp=function(t){var e=this;this.leftButtonDown=!1,this.setLastClientPositionFromEvent(t),this.isDragging&&(this.scheme.setCursorStyle(this.scheme.getDefaultCursorStyle()),this.scheme.requestRenderAll()),setTimeout(function(){e.isDragging=!1},1)},t.prototype.onClick=function(t){if(!this.isDragging){for(var e=this.findObjectsForEvent(t),i=0,n=e;i<n.length;i++){var o=n[i];o.click(t,this.scheme,this.scheme.getView()),this.scheme.addChangedObject(o),this.sendEvent("clickOnObject",o)}e.length&&(this.scheme.requestRenderAll(),this.scheme.updateCache(!0))}},t.prototype.onDoubleClick=function(t){var e=this.scheme.getZoomManager();e.zoomToPointer(t,e.getClickZoomDelta())},t.prototype.onContextMenu=function(t){},t.prototype.onMouseMove=function(t){if(this.leftButtonDown){var e=this.getCoordinatesFromEvent(t),i=Math.abs(e.x-this.getLastClientX()),n=Math.abs(e.y-this.getLastClientY());(1<i||1<n)&&(this.isDragging=!0,this.scheme.setCursorStyle("move"))}this.isDragging?this.scheme.getScrollManager().handleDragging(t):this.handleHover(t)},t.prototype.handleHover=function(t){this.setLastClientPositionFromEvent(t);var e=this.findObjectsForEvent(t),i=!1,n=!1;if(this.hoveredObjects.length)for(var o=0,s=this.hoveredObjects;o<s.length;o++){for(var r=s[o],a=!1,h=0,c=e;h<c.length;h++){(p=c[h])==r&&(a=!0)}if(!a){r.isHovered=!1;var u=r.mouseLeave(t,this.scheme,this.scheme.getView());this.scheme.addChangedObject(r),this.sendEvent("mouseLeaveObject",r),!1!==u&&(i=!0),n=!0}}if(!this.hoveredObjects.length||n)for(var g=0,l=e;g<l.length;g++){var p;(p=l[g]).isHovered=!0,this.scheme.setCursorStyle(p.cursorStyle),!1!==(u=p.mouseOver(t,this.scheme,this.scheme.getView()))&&(i=!0),this.scheme.addChangedObject(p),this.sendEvent("mouseOverObject",p,t)}(this.hoveredObjects=e).length||this.scheme.setCursorStyle(this.scheme.getDefaultCursorStyle()),i&&(this.scheme.requestRenderAll(),this.scheme.updateCache(!0))},t.prototype.onMouseOut=function(t){this.setLastClientPositionFromEvent(t),this.leftButtonDown=!1,this.isDragging=!1,this.scheme.requestRenderAll()},t.prototype.onMouseEnter=function(t){},t.prototype.onMouseWheel=function(t){return this.scheme.getZoomManager().handleMouseWheel(t)},t.prototype.setLastClientPositionFromEvent=function(t){var e=this.getCoordinatesFromEvent(t);this.setLastClientPosition(e)},t.prototype.findObjectsForEvent=function(t){var e=this.getCoordinatesFromEvent(t);return this.scheme.getStorageManager().findObjectsByCoordinates(e)},t.prototype.getCoordinatesFromEvent=function(t){var e=this.scheme.getCanvas().getBoundingClientRect();return{x:i.Tools.getPointer(t,"clientX")-e.left,y:i.Tools.getPointer(t,"clientY")-e.top}},t.prototype.setLastClientPosition=function(t){this.lastClientPosition=t},t.prototype.getLastClientX=function(){return this.lastClientPosition.x},t.prototype.getLastClientY=function(){return this.lastClientPosition.y},t.prototype.sendEvent=function(t,e,i){var n="schemeDesigner."+t;if("function"==typeof CustomEvent){var o=e;void 0!==i&&(o={data:e,originalEvent:i});var s=new CustomEvent(n,{detail:o});this.scheme.getCanvas().dispatchEvent(s)}else{var r=document.createEvent("CustomEvent");r.initCustomEvent(n,!1,!1,e),this.scheme.getCanvas().dispatchEvent(r)}},t.prototype.setDoubleTapDelay=function(t){this.doubleTapDelay=t},t}();i.EventManager=t}(SchemeDesigner||(SchemeDesigner={})),function(i){var t=function(){function t(t){this.isDragging=!1,this.leftButtonDown=!1,this.lastTouchEndTime=0,this.scheme=t}return t.prototype.getScaledSchemeRect=function(){var t=this.scheme.getStorageManager().getObjectsBoundingRect(),e=t.right,i=t.bottom,n=this.mapView.getWidth(),o=this.mapView.getHeight(),s=n/o<e/i?n/e:o/i,r=e*s,a=i*s;return{scaleFactor:s,width:r,height:a,leftOffset:(n-r)/2,topOffset:(o-a)/2}},t.prototype.getRectBoundingRect=function(t){var e=this.scheme.getVisibleBoundingRect(),i=e.left*t.scaleFactor+t.leftOffset,n=e.top*t.scaleFactor+t.topOffset;return{left:i,top:n,right:i+(e.right-e.left)*t.scaleFactor,bottom:n+(e.bottom-e.top)*t.scaleFactor}},t.prototype.drawMap=function(){var t=this.scheme.getCacheView();if(!this.mapView||!t)return!1;var e=this.getScaledSchemeRect(),i=this.mapView.getContext();i.clearRect(0,0,this.mapView.getWidth(),this.mapView.getHeight()),i.drawImage(t.getCanvas(),e.leftOffset,e.topOffset,e.width,e.height);var n=this.getRectBoundingRect(e);return this.drawRect(n),!0},t.prototype.drawRect=function(t){var e=this.mapView.getContext();e.lineWidth=1,e.strokeStyle="#000",e.strokeRect(t.left,t.top,t.right-t.left,t.bottom-t.top);var i=2*this.mapView.getWidth(),n=2*this.mapView.getHeight(),o="rgba(0, 0, 0, 0.1)";e.fillStyle=o,e.strokeStyle=o,e.lineWidth=0,e.fillRect(0,0,t.left,n),e.fillRect(t.left,0,t.right-t.left,t.top),e.fillRect(t.right,0,i,n),e.fillRect(t.left,t.bottom,t.right-t.left,n)},t.prototype.setMapCanvas=function(t){this.mapCanvas=t,this.mapView=new i.View(this.mapCanvas),this.bindEvents(),i.Tools.disableElementSelection(this.mapCanvas)},t.prototype.resize=function(){this.mapView&&this.mapView.resize()},t.prototype.bindEvents=function(){var e=this;this.mapCanvas.addEventListener("mousedown",function(t){e.onMouseDown(t)}),this.mapCanvas.addEventListener("mouseup",function(t){e.onMouseUp(t)}),this.mapCanvas.addEventListener("mousemove",function(t){e.onMouseMove(t)}),this.mapCanvas.addEventListener("mouseout",function(t){e.onMouseOut(t)}),this.mapCanvas.addEventListener("click",function(t){e.onClick(t)}),this.mapCanvas.addEventListener("mousewheel",function(t){e.onMouseWheel(t)}),this.mapCanvas.addEventListener("DOMMouseScroll",function(t){e.onMouseWheel(t)})},t.prototype.onMouseWheel=function(t){var e=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;if(e){var i=this.getCoordinatesFromEvent(t);this.scrollByCoordinates(i),this.scheme.getZoomManager().zoomToCenter(e)}return t.preventDefault()&&!1},t.prototype.onMouseDown=function(t){this.leftButtonDown=!0,this.setLastClientPositionFromEvent(t)},t.prototype.onMouseOut=function(t){this.setLastClientPositionFromEvent(t),this.leftButtonDown=!1,this.isDragging=!1},t.prototype.setCursorStyle=function(t){return this.mapCanvas.style.cursor=t,this},t.prototype.onMouseUp=function(t){var e=this;if(this.leftButtonDown=!1,this.setLastClientPositionFromEvent(t),this.isDragging){var i=this.getCoordinatesFromEvent(t);this.scrollByCoordinates(i),this.setCursorStyle("default")}setTimeout(function(){e.isDragging=!1},1)},t.prototype.onMouseMove=function(t){if(this.leftButtonDown){var e=this.getCoordinatesFromEvent(t),i=Math.abs(e.x-this.getLastClientX()),n=Math.abs(e.y-this.getLastClientY());(1<i||1<n)&&(this.isDragging=!0,this.setCursorStyle("move"))}if(this.isDragging){var o=this.getCoordinatesFromEvent(t);this.scrollByCoordinates(o)}},t.prototype.setLastClientPositionFromEvent=function(t){var e=this.getCoordinatesFromEvent(t);this.setLastClientPosition(e)},t.prototype.setLastClientPosition=function(t){this.lastClientPosition=t},t.prototype.getLastClientX=function(){return this.lastClientPosition.x},t.prototype.getLastClientY=function(){return this.lastClientPosition.y},t.prototype.getRealCoordinates=function(t){var e=this.getScaledSchemeRect(),i=this.scheme.getZoomManager().getScale(),n=this.scheme.getStorageManager().getObjectsBoundingRect(),o=this.getRectBoundingRect(e),s=o.right-o.left,r=o.bottom-o.top,a=(t.x-e.leftOffset-s/2)/e.scaleFactor,h=(t.y-e.topOffset-r/2)/e.scaleFactor;return{x:(a-n.left)*i,y:(h-n.top)*i}},t.prototype.scrollByCoordinates=function(t){var e=this.getRealCoordinates(t);this.scheme.getScrollManager().scroll(-e.x,-e.y)},t.prototype.onClick=function(t){if(!this.isDragging){var e=this.getCoordinatesFromEvent(t);this.scrollByCoordinates(e)}},t.prototype.getCoordinatesFromEvent=function(t){var e=this.mapCanvas.getBoundingClientRect();return{x:i.Tools.getPointer(t,"clientX")-e.left,y:i.Tools.getPointer(t,"clientY")-e.top}},t}();i.MapManager=t}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(t){this.scrollLeft=0,this.scrollTop=0,this.maxHiddenPart=.5,this.scheme=t}return t.prototype.getScrollLeft=function(){return this.scrollLeft},t.prototype.getScrollTop=function(){return this.scrollTop},t.prototype.scroll=function(t,e){var i=this.scheme.getStorageManager().getObjectsBoundingRect(),n=this.scheme.getZoomManager().getScale(),o=-i.left*n,s=-i.top*n,r=-i.right*n,a=-i.bottom*n;(o+=this.scheme.getWidth()*this.maxHiddenPart)<t&&(t=o),(s+=this.scheme.getHeight()*this.maxHiddenPart)<e&&(e=s),t<(r+=this.scheme.getWidth()*(1-this.maxHiddenPart))&&(t=r),e<(a+=this.scheme.getHeight()*(1-this.maxHiddenPart))&&(e=a),this.scrollLeft=t,this.scrollTop=e,this.scheme.getView().setScrollTop(e),this.scheme.getView().setScrollLeft(t),this.scheme.getView().applyTransformation(),this.scheme.useSchemeCache()?this.scheme.requestDrawFromCache():this.scheme.requestRenderAll(),this.scheme.getEventManager().sendEvent("scroll",{left:t,top:e,maxScrollLeft:o,maxScrollTop:s,minScrollLeft:r,minScrollTop:a,boundingRect:i,scale:n})},t.prototype.toCenter=function(){var t=this.scheme.getStorageManager().getObjectsBoundingRect(),e=this.scheme.getStorageManager().getObjectsDimensions(),i=this.scheme.getZoomManager().getScale(),n=this.scheme.getWidth()/i-e.width,o=this.scheme.getHeight()/i-e.height,s=(n/2-t.left)*i,r=(o/2-t.top)*i;this.scroll(s,r)},t.prototype.handleDragging=function(t){var e=this.scheme.getEventManager().getLastClientX(),i=this.scheme.getEventManager().getLastClientY();this.scheme.getEventManager().setLastClientPositionFromEvent(t);var n=this.scheme.getEventManager().getLastClientX()-e,o=this.scheme.getEventManager().getLastClientY()-i,s=n+this.getScrollLeft(),r=o+this.getScrollTop();this.scroll(s,r)},t.prototype.setMaxHiddenPart=function(t){this.maxHiddenPart=t},t}();t.ScrollManager=e}(SchemeDesigner||(SchemeDesigner={})),function(d){var t=function(){function t(t){this.treeDepth=6,this.layers={},this.scheme=t}return t.prototype.getLayerById=function(t){return void 0!==this.layers[t]?this.layers[t]:null},t.prototype.getVisibleObjects=function(){var t=[],e=this.getVisibleObjectsByLayers();for(var i in e){var n=e[i];void 0!==n&&n.length&&(t=t.concat(n))}return t},t.prototype.getVisibleObjectsByLayers=function(){for(var t={},e=0,i=this.getSortedLayers();e<i.length;e++){var n=i[e];if(n.isVisible()){var o=n.getObjects();void 0!==o&&o.length&&(t[n.getId()]=o)}}return t},t.prototype.setLayers=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.addLayer(n)}},t.prototype.getLayers=function(){return this.layers},t.prototype.getSortedLayers=function(){var t=[];for(var e in this.layers){var i=this.layers[e];i.isVisible()&&t.push(i)}return t.sort(function(t,e){return t.getZIndex()<e.getZIndex()?-1:t.getZIndex()>e.getZIndex()?1:0}),t},t.prototype.addLayer=function(t){if(this.getLayerById(t.getId())instanceof d.Layer)throw new Error("Layer with such id already exist");this.layers[t.getId()]=t},t.prototype.removeLayers=function(){this.layers={},this.applyStructureChange()},t.prototype.removeLayer=function(t){delete this.layers[t],this.applyStructureChange()},t.prototype.setLayerVisibility=function(t,e){var i=this.getLayerById(t);if(!(i instanceof d.Layer))throw new Error("Layer not found");i.setVisible(e),this.applyStructureChange()},t.prototype.setLayerActivity=function(t,e){var i=this.getLayerById(t);if(!(i instanceof d.Layer))throw new Error("Layer not found");i.setActive(e)},t.prototype.applyStructureChange=function(){this.requestBuildTree(),this.reCalcObjectsBoundingRect(),this.scheme.updateCache(!1),this.scheme.requestRenderAll()},t.prototype.findObjectsByCoordinates=function(t){var e=[],i=t.x,n=t.y;i-=this.scheme.getScrollManager().getScrollLeft(),n-=this.scheme.getScrollManager().getScrollTop(),i/=this.scheme.getZoomManager().getScale(),n/=this.scheme.getZoomManager().getScale();var o=this.getTree(),s=this.findNodeByCoordinates(o,{x:i,y:n}),r={};s&&(r=s.getObjectsByLayers());var a={x:i,y:n};for(var h in r){if(this.getLayerById(h).isActive())for(var c=0,u=r[h];c<u.length;c++){var g=u[c];if(g.isActive()){var l=g.getBoundingRect();if(d.Tools.pointInRect(a,l,g.getRotation())){var p={x:a.x-g.getX(),y:a.y-g.getY()};g.checkPointInObject(p,this.scheme,this.scheme.getView())&&e.push(g)}}}}return e},t.prototype.getObjectsBoundingRect=function(){return this.objectsBoundingRect||(this.objectsBoundingRect=this.calculateObjectsBoundingRect()),this.objectsBoundingRect},t.prototype.getObjectsDimensions=function(){var t=this.getObjectsBoundingRect();return{width:t.right-t.left,height:t.bottom-t.top}},t.prototype.reCalcObjectsBoundingRect=function(){this.objectsBoundingRect=null},t.prototype.calculateObjectsBoundingRect=function(){var t,e,i,n,o=this.getVisibleObjects();if(o.length)for(var s=0,r=o;s<r.length;s++){var a=r[s].getBoundingRect();(null==t||a.top<t)&&(t=a.top),(null==e||a.left<e)&&(e=a.left),(null==i||a.right>i)&&(i=a.right),(null==n||a.bottom>n)&&(n=a.bottom)}return{left:e,top:t,right:i,bottom:n}},t.prototype.setTreeDepth=function(t){this.treeDepth=t},t.prototype.requestBuildTree=function(){this.rootTreeNode=null},t.prototype.getTree=function(){return this.rootTreeNode||(this.rootTreeNode=this.buildTree()),this.rootTreeNode},t.prototype.buildTree=function(){var t=this.getObjectsBoundingRect();return this.rootTreeNode=new u(null,t,this.getVisibleObjectsByLayers(),0),this.explodeTreeNodes(this.rootTreeNode,this.treeDepth),this.rootTreeNode},t.prototype.explodeTreeNodes=function(t,e){if(this.explodeTreeNode(t),0<--e)for(var i=0,n=t.getChildren();i<n.length;i++){var o=n[i];this.explodeTreeNodes(o,e)}},t.prototype.explodeTreeNode=function(t){var e=t.getBoundingRect(),i=t.getDepth()+1,n=d.Tools.clone(e),o=d.Tools.clone(e);if(i%2==1){var s=(e.right-e.left)/2;n.right=n.right-s,o.left=o.left+s}else{s=(e.bottom-e.top)/2;n.bottom=n.bottom-s,o.top=o.top+s}var r=d.Tools.filterLayersObjectsByBoundingRect(n,t.getObjectsByLayers()),a=d.Tools.filterLayersObjectsByBoundingRect(o,t.getObjectsByLayers()),h=new u(t,n,r,i),c=new u(t,o,a,i);t.addChild(h),t.addChild(c),t.removeObjects()},t.prototype.findNodeByCoordinates=function(t,e){var i=t.getChildByCoordinates(e);return i?i.isLastNode()?i:this.findNodeByCoordinates(i,e):null},t.prototype.findNodesByBoundingRect=function(t,e){t||(t=this.getTree());for(var i=[],n=0,o=t.getChildrenByBoundingRect(e);n<o.length;n++){var s=o[n];if(s.isLastNode())i.push(s);else for(var r=0,a=this.findNodesByBoundingRect(s,e);r<a.length;r++){var h=a[r];i.push(h)}}return i},t.prototype.showNodesParts=function(){for(var t=this.getTree().getLastChildren(),e=this.scheme.getView().getContext(),i=0,n=t;i<n.length;i++){var o=n[i],s=o.getBoundingRect().left+this.scheme.getScrollManager().getScrollLeft(),r=o.getBoundingRect().top+this.scheme.getScrollManager().getScrollTop(),a=o.getBoundingRect().right-o.getBoundingRect().left,h=o.getBoundingRect().bottom-o.getBoundingRect().top;e.lineWidth=1,e.strokeStyle="black",e.rect(s,r,a,h),e.stroke()}},t.prototype.getImageStorage=function(t){return new d.ImageStorage(t,this.scheme)},t}();d.StorageManager=t;var u=function(){function t(t,e,i,n){this.children=[],this.objectsByLayers={},this.parent=t,this.boundingRect=e,this.objectsByLayers=i,this.depth=n}return t.prototype.addChild=function(t){this.children.push(t)},t.prototype.getObjects=function(){var t=[];for(var e in this.objectsByLayers){var i=this.objectsByLayers[e];void 0!==i&&i.length&&(t=t.concat(i))}return t},t.prototype.getObjectsByLayer=function(t){return void 0!==this.objectsByLayers[t]?this.objectsByLayers[t]:[]},t.prototype.getObjectsByLayers=function(){return this.objectsByLayers},t.prototype.getChildren=function(){return this.children},t.prototype.isLastNode=function(){return 0<Object.keys(this.objectsByLayers).length},t.prototype.getLastChildren=function(){for(var t=[],e=0,i=this.children;e<i.length;e++){var n=i[e];if(n.isLastNode())t.push(n);else for(var o=0,s=n.getLastChildren();o<s.length;o++){var r=s[o];t.push(r)}}return t},t.prototype.getChildByCoordinates=function(t){for(var e=0,i=this.children;e<i.length;e++){var n=i[e];if(d.Tools.pointInRect(t,n.getBoundingRect()))return n}return null},t.prototype.getChildrenByBoundingRect=function(t){for(var e=[],i=0,n=this.children;i<n.length;i++){var o=n[i];d.Tools.rectIntersectRect(o.getBoundingRect(),t)&&e.push(o)}return e},t.prototype.removeObjects=function(){this.objectsByLayers={}},t.prototype.getBoundingRect=function(){return this.boundingRect},t.prototype.getDepth=function(){return this.depth},t}();d.TreeNode=u}(SchemeDesigner||(SchemeDesigner={})),function(t){var e=function(){function t(t){this.scale=1,this.zoomCoefficient=1.04,this.clickZoomDelta=14,this.padding=.1,this.maxScale=5,this.scheme=t}return t.prototype.zoom=function(t){var e=this.getFactorByDelta(t);return this.zoomByFactor(e)},t.prototype.getFactorByDelta=function(t){return Math.pow(this.zoomCoefficient,t)},t.prototype.setScale=function(t){var e=this.scale/t;return this.zoomByFactor(e)},t.prototype.getScaleWithAllObjects=function(){var t=this.scheme.getStorageManager().getObjectsBoundingRect(),e=(t.right-t.left)*(this.padding+1)/this.scheme.getWidth(),i=(t.bottom-t.top)*(this.padding+1)/this.scheme.getHeight();return i<e?e:i},t.prototype.getMaxZoomScale=function(){var t=this.scheme.getStorageManager().getObjectsDimensions(),e=this.scheme.getWidth()*this.maxScale/t.width,i=this.scheme.getHeight()*this.maxScale/t.height;return i<e?e:i},t.prototype.getMinZoomScale=function(){var t=this.scheme.getStorageManager().getObjectsDimensions(),e=this.scheme.getWidth()*(1-this.padding)/t.width,i=this.scheme.getHeight()*(1-this.padding)/t.height;return e<i?e:i},t.prototype.canZoomByFactor=function(t){var e=this.scale*t;return t<1?this.getMinZoomScale()<e:this.getMaxZoomScale()>e},t.prototype.zoomByFactor=function(t){var e=this;this.renderAllTimer&&clearTimeout(this.renderAllTimer);var i=this.scale,n=i*t,o=this.getMaxZoomScale(),s=this.getMinZoomScale(),r=n;o<r&&(r=o),r<s&&(r=s);var a=r!=i;return this.scheme.getEventManager().sendEvent("zoom",{oldScale:i,newScale:r,factor:t,success:a}),a&&(this.scale=r,this.scheme.getView().setScale(r),this.scheme.getView().applyTransformation(),this.scheme.useSchemeCache()?(this.scheme.requestDrawFromCache(),this.renderAllTimer=setTimeout(function(){e.scheme.requestRenderAll()},300)):this.scheme.requestRenderAll(),!0)},t.prototype.getScale=function(){return this.scale},t.prototype.resetScale=function(){this.scale=1},t.prototype.handleMouseWheel=function(t){var e=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;return e&&this.zoomToPointer(t,e),t.preventDefault()&&!1},t.prototype.zoomToPointer=function(t,e){this.scheme.getEventManager().setLastClientPositionFromEvent(t),this.zoomToPoint({x:this.scheme.getEventManager().getLastClientX(),y:this.scheme.getEventManager().getLastClientY()},e)},t.prototype.zoomToCenter=function(t){this.zoomToPoint({x:this.scheme.getWidth()/2,y:this.scheme.getHeight()/2},t)},t.prototype.zoomToPoint=function(t,e){var i=this.scheme.getZoomManager().getScale();if(this.scheme.getZoomManager().zoom(e)){var n=this.scheme.getZoomManager().getScale(),o=t.x/i,s=t.y/i,r=i/n,a=(t.x/n-o)*n,h=(t.y/n-s)*n,c=this.scheme.getScrollManager().getScrollLeft()/r,u=this.scheme.getScrollManager().getScrollTop()/r;this.scheme.getScrollManager().scroll(c+a,u+h)}},t.prototype.setPadding=function(t){this.padding=t},t.prototype.setMaxScale=function(t){this.maxScale=t},t.prototype.setZoomCoefficient=function(t){this.zoomCoefficient=t},t.prototype.setClickZoomDelta=function(t){this.clickZoomDelta=t},t.prototype.getClickZoomDelta=function(){return this.clickZoomDelta},t}();t.ZoomManager=e}(SchemeDesigner||(SchemeDesigner={}));